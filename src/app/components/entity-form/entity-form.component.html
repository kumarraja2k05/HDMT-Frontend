<app-header></app-header>
<app-side-bar></app-side-bar>
<div class="container-fluid entity-div">
  <div class="container">
    <div class="container d-inline-flex p-2">
      <div class="row mt-4 mb-2 text-center">
        <div class="col">
          <button
            type="button"
            (click)="openEntityFormModal()"
            class="btn btn-danger"
          >
            Add Entity
          </button>
        </div>
      </div>
    </div>

    <div
      class="modal dark"
      id="entityModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-xl modal-dialog-centered entity-form">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Create Entity</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <div class="modal-body">
            <form #entityForm="ngForm" (ngSubmit)="getEntityData(entityForm.value)">

              <div>
                <div class="form-group row">
                  <div class="col-sm-3 col-form-label">
                    <label for="entityname">Entity Name:</label>
                  </div>
                  <div class="col-sm-9">
                    <input class="form-control" type="text" id="entityname" name="entity_name" placeholder="Enter Entity Name" ngModel>
                  </div>
                </div>

                <div class="form-group row">
                  <div class="col-sm-3 col-form-label">
                    <label for="entity_type">Choose Entity Type:</label>
                  </div>
                  <div class="col-sm-9">
                    <select class="form-control" id="entity_type" name="entity_type" ngModel>
                      <option disabled>Choose From Dropdown</option>
                      <option>University</option>
                      <option>College</option>
                    </select>
                  </div>
                </div>

                <div class="form-group row">
                  <div class="col-sm-3 col-form-label">
                    <label for="entityplace">Entity Place:</label>
                  </div>
                  <div class="col-sm-9">
                    <input class="form-control" type="text" id="entityplace" name="entity_place" placeholder="Enter Entity Place" ngModel>
                  </div>
                </div>

                <h4 for="EntityContact">Contact Person:</h4>
                
                <div class="form-group row border border-dark py-4">
                  <div *ngFor="let obj of contactPersons; let i = index">
                    <div class="col-sm-4 input-short d-inline-flex">
                        <input class="form-control" type="text" id="coordinator" name="contactDetails" placeholder="Name" [(ngModel)]="obj.contactName">
                    </div>

                    <div class="col-sm-4 input-short d-inline-flex">
                        <input
                          class=" form-control"
                          type="email"
                          placeholder="Email"
                          name="contactDetails"
                          id="email"
                          required
                          [(ngModel)]="obj.contactEmail"/>
                      
                    </div>
                    <div class="col-sm-4 input-short d-inline-flex">
                        <input
                          class=" form-control"
                          type="tel"
                          id="fnum"
                          placeholder="Number"
                          name="contactDetails"
                          [(ngModel)]="obj.contactPhone"/>
                    </div>
                    <div class="col-sm-1 my-2 d-inline-flex">
                      <span
                        class="delete-icon glyphicon glyphicon-trash space"
                        (click)="removeContact(i)"
                        *ngIf="checkIndex(i)">
                      </span>
                    </div>
                  </div>
                </div>

                <div class="add_remove">
                  <span class="btn btn-danger " (click)="addContact()">Add contact +</span>
                </div>

                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal">Close
                  </button>
                  <button
                    type="submit"
                    class="btn btn-success"
                    (click)="saveEntity()">Save changes
                  </button>
                </div>

              </div>

            </form>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal dark"
      id="editEntityModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Edit Entity</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <div class="modal-body">
            <form
            #editEntityForm="ngForm"
            (ngSubmit)="updateEntityData(editEntityForm.value)"
            >
              <label for="entityname">Entity Name:</label>
              <input
                type="text"
                id="entityname"
                name="entity_name"
                value="{{entityName}}"
                [disabled]="true"
                ngModel
              /><br />

              <div>
                <label for="entity_type">Choose Entity Type:</label>
                <select id="entity_type" name="entity_type" ngModel>
                  <option>University</option>
                  <option>College</option>
                </select>
              </div>

              <label for="entityplace">Entity Place:</label>
              <input
                type="text"
                id="entityplace"
                name="entity_place"
                value="{{entityPlace}}"
                [disabled]="true"
                ngModel
              /><br />
              <h4 for="EntityContact">Contact Person:</h4>
              
              <div class="border border-dark p-4">
                <div *ngFor="let obj of contactPersons; let i = index">
                  <span
                    ><input
                      class="input-short"
                      type="text"
                      id="coordinator"
                      name="contactDetails"
                      placeholder="Name"
                      [(ngModel)]="obj.contactName"
                  /></span>

                  <span class="space"
                    ><input
                      class="input-short"
                      type="email"
                      placeholder="Email"
                      name="contactDetails"
                      id="email"
                      required
                      [(ngModel)]="obj.contactEmail"
                  /></span>

                  <span class="space"
                    ><input
                      class="input-short"
                      type="tel"
                      id="fnum"
                      placeholder="Number"
                      name="contactDetails"
                      [(ngModel)]="obj.contactPhone"
                  /></span>
                  <span
                    class="glyphicon glyphicon-trash space"
                    (click)="removeContact(i)"
                    *ngIf="checkIndex(i)"
                    ></span
                  >
                </div>
              </div>
              <div class="add_remove">
                <span class="btn btn-danger " (click)="addContact()"
                  >Add contact +</span
                >
              </div>

              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Close
                </button>
                <button
                  type="submit"
                  class="btn btn-success"
                  (click)="saveEditedEntity()"
                >
                  Apply changes
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

  </div>
  <table
    class="table table-bordered table-striped table-hover display"
    datatable
    [dtOptions]="dtOptions"
    [dtTrigger]="dtTrigger"
  >
    <thead>
      <tr>
        <th>Entity Name</th>
        <th>Entity Type</th>
        <th>Entity Place</th>
        <th>Edit Form</th>
      </tr>
    </thead>
    <tbody>
      <tr class="view" *ngFor="let entity of EntityData">
        <td>
          {{ entity.entity_name }}
        </td>
        <td>{{ entity.entity_type }}</td>
        <td>{{ entity.entity_place }}</td>
        <td class="text-center text-danger">
          <svg type="button" 
          (click)="openEditEntityFormModal(); replicateData(entity)"
          xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
            <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
            <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
          </svg>
        </td>
      </tr>
    </tbody>
    <tbody *ngIf="EntityData?.length == 0">
      <tr>
        <td colspan="3" class="no-data-available">No data!</td>
      </tr>
    </tbody>
  </table>
</div>
