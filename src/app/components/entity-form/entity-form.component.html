<app-header></app-header>
<app-side-bar></app-side-bar>
<div class="container-fluid entity-div">
  <div class="container-fluid bread">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a routerLink="/home">Dashboard</a></li>
      <li class="breadcrumb-item"><a routerLink="/entity-form">Entity</a></li>
    </ol>
  </div>
  <div class="container-fluid">
    <div class="container-fluid ">
      <div class="container-fluid d-inline-flex row p-2">
        <div class="col-sm-6 entity-button">
            <button type="button" (click)="openEntityFormModal()" class="btn btn-danger">
              <span class="glyphicon glyphicon-plus-sign"></span> Add Entity
            </button>
        </div>
        <div class="col-sm-6  heading">
          <h2>Entity Data</h2>
        </div>
      </div>
      <div>
        
      </div>
  
      <div
        class="modal dark"
        id="entityModal"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-xl modal-dialog-centered entity-form">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Create Entity</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
  
            <div class="modal-body">
              <form #entityForm="ngForm" (ngSubmit)="getEntityData(entityForm.value)">
  
                <div>
                  <div class="form-group row">
                    <div class="col-sm-3 col-form-label">
                      <label for="entityname">Entity Name:</label>
                    </div>
                    <div class="col-sm-9">
                      <input class="form-control" type="text" id="entityname" name="entity_name" placeholder="Enter Entity Name" ngModel>
                    </div>
                  </div>
  
                  <div class="form-group row">
                    <div class="col-sm-3 col-form-label">
                      <label for="entity_type">Choose Entity Type:</label>
                    </div>
                    <div class="col-sm-9">
                      <!-- <select class="form-select form-select-lg" id="entity_type" name="entity_type" ngModel> -->
                      <select class="form-select form-select-lg" aria-label="Default select example" id="entityType" name="entity_type" ngModel>
                        <option selected>Select Entity Type</option>
                        <option>College</option>
                        <option>University</option>
                      </select>
                    </div>
                  </div>

                  <div class="form-group row">
                    <div class="col-sm-3 col-form-label">
                      <label for="entityplace">Entity Place:</label>
                    </div>
                    <div class="col-sm-9">
                      <input class="form-control" type="text" id="entityplace" name="entity_place" placeholder="Enter Entity Place" ngModel>
                    </div>
                  </div>
  
                  <h4 for="EntityContact">Contact Person:</h4>
                  
                  <div class="form-group row border border-dark py-4">
                    <div *ngFor="let obj of contactPersons; let i = index">
                      <div class="col-sm-4 input-short d-inline-flex">
                          <input class="form-control" type="text" id="contactName" name="contactName" placeholder="Name" required [(ngModel)]="obj.contactName">
                      </div>
  
                      <div class="col-sm-4 input-short d-inline-flex">
                          <input class=" form-control" type="email" placeholder="Email" name="contactEmail" id="email" required [(ngModel)]="obj.contactEmail"/>
                      </div>
                      <div class="col-sm-4 input-short d-inline-flex">
                          <input class=" form-control" type="tel" id="fnum" placeholder="Number" name="contactPhone" required [(ngModel)]="obj.contactPhone"/>
                      </div>
                      <div class="col-sm-1 my-2 d-inline-flex">
                        <span class="delete-icon glyphicon glyphicon-trash space" (click)="removeContact(i)" *ngIf="checkIndex(i)">
                        </span>
                      </div>
                    </div>
                  </div>
  
                  <div class="add_remove">
                    <span class="btn btn-danger " (click)="addContact()"><span class="glyphicon glyphicon-plus-sign"></span> Add contact </span>
                  </div>
  
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-success" (click)="saveEntity()">Save changes </button>
                  </div>
  
                </div>
  
              </form>
            </div>
          </div>
        </div>
      </div>
  
      <div class="modal dark" id="editEntityModal" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-xl modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Edit Entity</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
  
            <div class="modal-body">

              <form #editEntityForm="ngForm" (ngSubmit)="updateEntityData(editEntityForm.value)">
  
                <div>
                  <div class="form-group row">
                    <div class="col-sm-3 col-form-label">
                      <label for="entityname">Entity Name:</label>
                    </div>
                    <div class="col-sm-9">
                      <input class="form-control" type="text" id="entityname" name="entity_name" placeholder="Enter Entity Name" value="{{entityName}}"
                      [disabled]="true"
                      ngModel>
                    </div>
                  </div>
  
                  <div class="form-group row">
                    <div class="col-sm-3 col-form-label">
                      <label for="entity_type">Choose Entity Type:</label>
                    </div>
                    <div class="col-sm-9">
                      <select class="form-select form-select-lg" aria-label="Default select example" id="entityType" name="entity_type" ngModel>
                        <option selected>Select Entity Type</option>
                        <option>College</option>
                        <option>University</option>
                      </select>
                    </div>
                  </div>

                  <div class="form-group row">
                    <div class="col-sm-3 col-form-label">
                      <label for="entityplace">Entity Place:</label>
                    </div>
                    <div class="col-sm-9">
                      <input class="form-control" type="text" id="entityplace" name="entity_place" placeholder="Enter Entity Place" value="{{entityPlace}}"
                      [disabled]="true"
                      ngModel>
                    </div>
                  </div>
  
                  <h4 for="EntityContact">Contact Person:</h4>
                  
                  <div class="form-group row border border-dark py-4">
                    <div *ngFor="let obj of contactPersons; let i = index">
                      <div class="col-sm-4 input-short d-inline-flex">
                          <input class="form-control" type="text" id="contactName" name="contactName" placeholder="Name" [(ngModel)]="obj.contactName">
                      </div>
  
                      <div class="col-sm-4 input-short d-inline-flex">
                          <input
                            class=" form-control"
                            type="email"
                            placeholder="Email"
                            name="contactEmail"
                            id="email"
                            required
                            [(ngModel)]="obj.contactEmail"/>
                        
                      </div>
                      <div class="col-sm-4 input-short d-inline-flex">
                          <input
                            class=" form-control"
                            type="tel"
                            id="fnum"
                            placeholder="Number"
                            name="contactPhone"
                            [(ngModel)]="obj.contactPhone"/>
                      </div>
                      <div class="col-sm-1 my-2 d-inline-flex">
                        <span
                          class="delete-icon glyphicon glyphicon-trash space"
                          (click)="removeContact(i)"
                          *ngIf="checkIndex(i)">
                        </span>
                      </div>
                    </div>
                  </div>
  
                  <div class="add_remove">
                    <span class="btn btn-danger " (click)="addContact()"><span class="glyphicon glyphicon-plus-sign"></span> Add contact </span>
                  </div>
  
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal">Close
                    </button>
                    <button
                      type="submit"
                      class="btn btn-success"
                      (click)="saveEditedEntity()" data-bs-dismiss="modal">Save changes
                    </button>
                  </div>
  
                </div>
  
              </form>

              <!-- <form
              #editEntityForm="ngForm"
              (ngSubmit)="updateEntityData(editEntityForm.value)"
              >
                <label for="entityname">Entity Name:</label>
                <input
                  type="text"
                  id="entityname"
                  name="entity_name"
                  value="{{entityName}}"
                  [disabled]="true"
                  ngModel
                /><br />
  
                <div>
                  <label for="entity_type">Choose Entity Type:</label>
                  <select id="entity_type" name="entity_type" ngModel>
                    <option>University</option>
                    <option>College</option>
                  </select>
                </div>
  
                <label for="entityplace">Entity Place:</label>
                <input
                  type="text"
                  id="entityplace"
                  name="entity_place"
                  value="{{entityPlace}}"
                  [disabled]="true"
                  ngModel
                /><br />
                <h4 for="EntityContact">Contact Person:</h4>
                
                <div class="border border-dark p-4">
                  <div *ngFor="let obj of contactPersons; let i = index">
                    <span
                      ><input
                        class="input-short"
                        type="text"
                        id="coordinator"
                        name="contactDetails"
                        placeholder="Name"
                        [(ngModel)]="obj.contactName"
                    /></span>
  
                    <span class="space"
                      ><input
                        class="input-short"
                        type="email"
                        placeholder="Email"
                        name="contactDetails"
                        id="email"
                        required
                        [(ngModel)]="obj.contactEmail"
                    /></span>
  
                    <span class="space"
                      ><input
                        class="input-short"
                        type="tel"
                        id="fnum"
                        placeholder="Number"
                        name="contactDetails"
                        [(ngModel)]="obj.contactPhone"
                    /></span>
                    <span
                      class="glyphicon glyphicon-trash space"
                      (click)="removeContact(i)"
                      *ngIf="checkIndex(i)"
                      ></span
                    >
                  </div>
                </div>
                <div class="add_remove">
                  <span class="btn btn-danger " (click)="addContact()"
                    ><span class="glyphicon glyphicon-plus-sign"></span> Add contact</span
                  >
                </div>
  
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    Close
                  </button>
                  <button
                    type="submit"
                    class="btn btn-success"
                    (click)="saveEditedEntity()"
                  >
                    Apply changes
                  </button>
                </div>
              </form> -->
            </div>
          </div>
        </div>
      </div>
  
    </div>
    <table
      class="table table-bordered table-striped table-hover display"
      datatable
      [dtOptions]="dtOptions"
      [dtTrigger]="dtTrigger"
    >
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Place</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr class="view" *ngFor="let entity of EntityData">
          <td>
            {{ entity.entity_name }}
          </td>
          <td>{{ entity.entity_type }}</td>
          <td>{{ entity.entity_place }}</td>
          <td class="text-center">
            <span class="text-danger">
              <svg type="button" 
                (click)="openEditEntityFormModal(); replicateData(entity)"
                xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
              </svg>
            </span>
            <span> | </span>
            <span type="button" class="text-success" (click)="viewRecord(entity.entity_name)">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
                <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
                <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
              </svg>
            </span>
          </td>
        </tr>
      </tbody>
      <tbody *ngIf="EntityData?.length == 0">
        <tr>
          <td colspan="3" class="no-data-available">No data!</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div
    class="modal dark"
    id="fullEntityData"
    tabindex="-1"
    aria-labelledby="exampleModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-xl modal-dialog-centered entity-form">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">View Entity</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <table class="table table-bordered table-striped table-hover display">
            <thead>
              <tr>
                <th>Name</th>
                <th>Contact Name</th>
                <th>Contact Mobile Number</th>
                <th>Contact Email</th>
              </tr>
            </thead>
            <tbody>
              <tr class="view" *ngFor="let item of specificEntityData">
                
                <td>{{ item.entity_name }}</td>
                <!-- <td >
                  {{item | json }}

                 <tr *ngFor="let details of item.contactDetails;let i=index">{{details['contact'+i].contactEmail}} - {{details['contact'+i].contactName}} - {{details['contact'+i].contactPhone}}</tr>
                </td> -->
                <td>{{ item.coordinator_name}}</td>
                <td>{{ item.coordinator_contact }}</td>
                <td>{{ item.coordinator_email }}</td>
              </tr>
            </tbody>
            <tbody *ngIf="EntityData?.length == 0">
              <tr>
                <td colspan="3" class="no-data-available">No data!</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

</div>
